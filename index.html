<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/app-logo.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Check</title>
  <!-- PWA Manifest Link -->
  <link rel="manifest" href="/manifest.json" />
  <!-- Theme Color for Browser UI -->
  <meta name="theme-color" content="#3b82f6">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // VISUAL LOGGER FOR MOBILE DEBUGGING
    function logToScreen(msg) {
      const logContainer = document.getElementById('debug-log');
      if (logContainer) {
        const line = document.createElement('div');
        line.textContent = '> ' + msg;
        line.style.borderBottom = '1px solid #334155';
        line.style.padding = '4px 0';
        logContainer.appendChild(line);
        console.log(msg);
      }
    }

    window.onerror = function (msg, url, lineNo, columnNo, error) {
      logToScreen('ERROR: ' + msg + ' (' + lineNo + ')');
      return false;
    };

    // CAPTURE RESOURCE LOADING ERRORS (Scripts, Images, CSS)
    window.addEventListener('error', function (e) {
      if (e.target && (e.target.tagName === 'SCRIPT' || e.target.tagName === 'LINK')) {
        const src = e.target.src || e.target.href;
        logToScreen('RESOURCE ERROR: Failed to load ' + src);
      }
    }, true);

    window.addEventListener('unhandledrejection', function (event) {

      window.addEventListener('unhandledrejection', function (event) {
        logToScreen('PROMISE ERROR: ' + event.reason);
      });

      // Notify user that HTML executed
      window.addEventListener('DOMContentLoaded', () => {
        logToScreen('DOM Loaded');

        // NUCLEAR OPTION: Unregister all Service Workers to clear stale cache
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(function (registrations) {
            for (let registration of registrations) {
              logToScreen('Removing Old Service Worker...');
              registration.unregister();
            }
            if (registrations.length > 0) {
              logToScreen('Cache Cleared! Reloading...');
              setTimeout(() => window.location.reload(), 1000); // Reload once after clearing
            }
          });
        }
      });
      window.addEventListener('load', () => {
        logToScreen('Window Loaded');
      });
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              slate: {
                850: '#1e293b', // Custom dark shade
                900: '#0f172a',
                950: '#020617',
              }
            },
            animation: {
              'blob': 'blob 7s infinite',
              'fade-in': 'fadeIn 0.5s ease-out',
              'scale-up': 'scaleUp 0.3s ease-out',
              'slide-in-right': 'slideInRight 0.3s ease-out',
              'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            },
            keyframes: {
              blob: {
                '0%': { transform: 'translate(0px, 0px) scale(1)' },
                '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                '100%': { transform: 'translate(0px, 0px) scale(1)' },
              },
              fadeIn: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
              scaleUp: {
                '0%': { transform: 'scale(0.95)', opacity: '0' },
                '100%': { transform: 'scale(1)', opacity: '1' },
              },
              slideInRight: {
                '0%': { transform: 'translateX(100%)' },
                '100%': { transform: 'translateX(0)' },
              }
            }
          }
        }
      }
  </script>
  <style>
    /* Custom scrollbar for better aesthetics */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    .dark ::-webkit-scrollbar-track {
      background: #1e293b;
    }

    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    body {
      /* A subtle pattern for a more premium feel */
      background-image: radial-gradient(circle at 1px 1px, #d1d5db 1px, transparent 0);
      background-size: 20px 20px;
      transition: background-color 0.3s ease;
    }

    .dark body {
      background-color: #000000;
      /* Pitch Black */
      background-image: none;
    }

    /* Hide default number input arrows for a cleaner, custom UI */
    input[type='number']::-webkit-inner-spin-button,
    input[type='number']::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type='number'] {
      -moz-appearance: textfield;
      /* Firefox */
    }
  </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.0/client",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "recharts": "https://aistudiocdn.com/recharts@^3.3.0",
    "firebase/app": "https://aistudiocdn.com/firebase@^12.5.0/app.js",
    "firebase/auth": "https://aistudiocdn.com/firebase@^12.5.0/auth.js",
    "firebase/firestore": "https://aistudiocdn.com/firebase@^12.5.0/firestore.js",
    "firebase/": "https://aistudiocdn.com/firebase@^12.5.0/"
  }
}
</script>
</head>

<body class="bg-gray-50 dark:bg-black antialiased text-slate-900 dark:text-slate-100">
  <div id="root">
    <div
      style="display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #0f172a; color: white; font-family: sans-serif;">
      <div style="text-align: center;">
        <svg style="animation: spin 1s linear infinite; height: 3rem; width: 3rem; color: #3b82f6; margin-bottom: 1rem;"
          xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle style="opacity: 0.25;" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path style="opacity: 0.75;" fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
          </path>
        </svg>
        <p>Caricamento Daily Check...</p>
      </div>
      <style>
        @keyframes spin {
          from {
            transform: rotate(0deg);
          }

          to {
            transform: rotate(360deg);
          }
        }
      </style>
      <div id="debug-log"
        style="margin-top: 20px; font-family: monospace; font-size: 10px; color: #94a3b8; text-align: left; width: 100%; max-width: 300px; max-height: 200px; overflow: auto;">
        <div>Inizializzazione...</div>
      </div>
    </div>
  </div>
  <script type="module" src="/index.tsx"></script>

  <!-- Load PDF libraries globally at the end of body -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>

</html>